
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Monte Carlo for a Lennard Jones Fluid &#8212; UC Berkeley Chem 280  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=4974aa07" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'day4/02-LJ-MC';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/msse_logo.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/msse_logo.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">UC Berkeley MSSE - Chem 280</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../setup.html">
    Computer Set-Up
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../day1.html">
    Day 1
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://msse.berkeley.edu/">
    MSSE
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/msse-chem-280-2024/msse-chem-280-2024.github.io" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/MolSSI_NSF" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../setup.html">
    Computer Set-Up
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../day1.html">
    Day 1
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://msse.berkeley.edu/">
    MSSE
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/msse-chem-280-2024/msse-chem-280-2024.github.io" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/MolSSI_NSF" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Monte Carlo...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="monte-carlo-for-a-lennard-jones-fluid">
<h1>Monte Carlo for a Lennard Jones Fluid<a class="headerlink" href="#monte-carlo-for-a-lennard-jones-fluid" title="Link to this heading">#</a></h1>
<div class="overview admonition">
<p class="admonition-title">Overview</p>
<p>Questions:</p>
<ul class="simple">
<li><p>How do I write a Monte Carlo simulation?</p></li>
</ul>
<p>Objectives:</p>
<ul class="simple">
<li><p>Use the Metropolis algorithm to sample configurations of LJ particles</p></li>
</ul>
</div>
<div class="caution admonition">
<p class="admonition-title">Thermodynamics and Statistical Mechanics</p>
<p>This lesson glosses over ideas from thermodynamics and statistical mechanics.
These disciplines play a huge role in computational molecular science.</p>
<p>If you would like to learn more about these topics, we suggest
free <a class="reference external" href="https://web.stanford.edu/~peastman/statmech/">Introduction to Statistical Mechanics</a>
available from Stanford, and/or <a class="reference external" href="https://academic-oup-com.libproxy.berkeley.edu/book/496?login=true">“The Laws of Thermodynamics: A Very Short Introduction”</a>, available as an e-book (for free with login) from UC Berkeley libraries.</p>
</div>
<section id="lesson-slides">
<h2>Lesson Slides<a class="headerlink" href="#lesson-slides" title="Link to this heading">#</a></h2>
<p><a class="reference download internal" download="" href="../_downloads/3eb1a730bb1e20847c230acdcf8fb4e3/mc-lj-part2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Lesson</span> <span class="pre">Slides</span></code></a></p>
<p>Continue from the notebook you created in the previous lesson.</p>
<p>Recall that our objective is to write a Monte Carlo simulation which we can use to estimate properties of a chemical system. Previously, we used MC integration to evaluate the area of the unit circle.</p>
<p>We learned that thermodynamic properties can be thought of as very high dimensional integrals.</p>
<div class="math notranslate nohighlight">
\[ \left&lt;Q\right&gt; = \int_V Q\left(\textbf{r}^N\right)
	\rho\left(\textbf{r}^N\right) d\textbf{r}^N
	\label{eq.statMechAverage} \]</div>
<p>where <span class="math notranslate nohighlight">\(Q\left(\textbf{r}^N\right)\)</span> is the thermodynamic quantity of interest that depends on only on the configuration, <span class="math notranslate nohighlight">\(\rho\left(\textbf{r}^N\right) \)</span> is the probability density, and <span class="math notranslate nohighlight">\(V\)</span> defines the volume of configuration space over which <span class="math notranslate nohighlight">\(\rho\)</span> has support.</p>
<p>Notice here that unlike our integral yesterday, we have a probability density present in the integral. This depends on the conditions of your system (we will use constant volume, constant temperature). This probability density usually depends on temperature.</p>
<p>In our case, the thermodynamic quantity of interest, <span class="math notranslate nohighlight">\(Q\)</span>, was the system potential energy. We used the Lennard Jones equation to build a model of a thermodynamic property (potential energy) of a system of particles.</p>
<p>It is now our task to generate sample configurations of the system. As a consequence, we will be able to measure structural properties of the atoms.</p>
</section>
<section id="writing-the-monte-carlo-loop">
<h2>Writing the Monte Carlo Loop<a class="headerlink" href="#writing-the-monte-carlo-loop" title="Link to this heading">#</a></h2>
<p>Just like with our first Monte Carlo examples, we will be relying on random numbers to sample our configuration space. This translates into generating possible coordinates for our system. However, due to because our high dimensional integral is dominated by a relatively small region of configurational space, it would be very inefficient just pick random numbers for all of our particles. To overcome this problem, we will use the ideas of <strong>importance sampling</strong>.</p>
<section id="importance-sampling">
<h3>Importance Sampling<a class="headerlink" href="#importance-sampling" title="Link to this heading">#</a></h3>
<p>A solution to this problem is to sample positions from the desired equilibrium probability density. This will generate relevant configurations more frequently than configurations that have low probability. This idea is known as <strong>importance sampling</strong>.</p>
<p>A uniform probability density would means that all values are equally likely. Since our system has so many possible system configurations and many of them are not likely to occur, we do not want to waste time/computational resources on those configurations. We will sample positions from the desired equilibrium probability density <span class="math notranslate nohighlight">\(\rho\left(\textbf{r}^N\right)\)</span>.</p>
</section>
<section id="acceptance-criteria">
<h3>Acceptance Criteria<a class="headerlink" href="#acceptance-criteria" title="Link to this heading">#</a></h3>
<p>Now that we know our goal, how will we generate atomic positions which are distributed according to <span class="math notranslate nohighlight">\(\rho\left(\textbf{r}^N\right)\)</span>.</p>
<p>We are gong to use the <em>Metropolis-Hasting</em> algorithm for accepting configurations. The <em>Metropolis-Hasting</em> acceptance criteria was first proposed in 1953 by Nicholas Metropolis, and expanded in 1970 by W.K. Hasting.  For our system, the probability that we will accept a change of coordinates is expressed with the following equation:</p>
<div class="math notranslate nohighlight">
\[ P_{acc}(m \rightarrow n) = \text{min} \left[
		1,e^{-\beta \Delta U}
	\right] \]</div>
<p>Here, <span class="math notranslate nohighlight">\( \beta \)</span> is equal to <span class="math notranslate nohighlight">\( 1/ T \)</span> (<span class="math notranslate nohighlight">\(T\)</span> is temperature).</p>
<p>Practically, the way this works is that we will start with atoms in some configuration. We calculate the potential energy of that configuration. Then, we make a change in coordinates. If the system is at lower energy, we accept this move as a new configuration. If the system is at a higher energy, we accept or reject that configuration based on comparing <span class="math notranslate nohighlight">\(e^{-\beta \Delta U}\)</span> and a random number.</p>
<p>This is a Markov Chain Monte Carlo method, meaning that acceptance of a random configuration depends on the system’s previous configuration. This is in contrast to our calculation of <span class="math notranslate nohighlight">\(\pi\)</span> where all points were independent of one another.</p>
</section>
<section id="flow-of-calculations">
<h3>Flow of Calculations<a class="headerlink" href="#flow-of-calculations" title="Link to this heading">#</a></h3>
<p>The workflow for a implementing an MC simulation is shown in the image and summarized below</p>
<img alt="../_images/mc_gif2.gif" class="align-center" src="../_images/mc_gif2.gif" />
<ol class="arabic simple">
<li><p>Generate an initial system state <span class="math notranslate nohighlight">\(m\)</span>.</p></li>
<li><p>Choose an atom with uniform probability from <span class="math notranslate nohighlight">\(\{1, \ldots, N\}\)</span> from old state <span class="math notranslate nohighlight">\(m\)</span>.</p></li>
<li><p>Propose a new state <span class="math notranslate nohighlight">\(n\)</span> by translating a LJ particle by a uniform random displacement <span class="math notranslate nohighlight">\(\Delta r \sim U(-\Delta x, +\Delta x)\)</span> in each dimension.</p>
<ul class="simple">
<li><p>The displacement scale <span class="math notranslate nohighlight">\(\Delta x\)</span> should not be too large as this would
likely result in particle overlaps, but should not be too small
as this would result in a slow sampling of configurational space.</p></li>
</ul>
</li>
<li><p>The difference in energy between the new and old states is computed.</p></li>
<li><p>The new state is accepted or rejected using the Metropolis criterion.Practically, this can be implemented as follows.</p>
<ul class="simple">
<li><p>If a move from <span class="math notranslate nohighlight">\(m\)</span> to <span class="math notranslate nohighlight">\(n\)</span> is “downhill”, <span class="math notranslate nohighlight">\(\beta \Delta U \leq 0\)</span>,
the move is always accepted. For “uphill” moves, a random number <span class="math notranslate nohighlight">\(\zeta\)</span> is generated uniformly on (0,1).</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\zeta &lt; \exp[-\beta {\Delta U}]\)</span>, the move is accepted.  Otherwise, the move is rejected.</p></li>
</ul>
</li>
</ol>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-0">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">accept_or_reject</span><span class="p">(</span><span class="n">delta_e</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">delta_e</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">accept</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">random_number</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">p_acc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">delta_e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random_number</span> <span class="o">&lt;</span> <span class="n">p_acc</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">accept</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sanity-check">
<h3>Sanity check<a class="headerlink" href="#sanity-check" title="Link to this heading">#</a></h3>
<p>Let’s do some of our normal sanity checks. We can think of a few things that should be true for this function:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> should be returned for a negative <code class="docutils literal notranslate"><span class="pre">delta_e</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> should be returned for <code class="docutils literal notranslate"><span class="pre">delta_e</span> <span class="pre">==</span> <span class="pre">0</span></code></p></li>
</ol>
<p>For simplicity, we’ll use a beta value of 1 for these two tests:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-1" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-1">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">delta_energy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">accept_or_reject</span><span class="p">(</span><span class="n">delta_energy</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

<span class="n">delta_energy</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">accept_or_reject</span><span class="p">(</span><span class="n">delta_energy</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<section id="random-numbers">
<h4>Random Numbers<a class="headerlink" href="#random-numbers" title="Link to this heading">#</a></h4>
<p>For <code class="docutils literal notranslate"><span class="pre">delta_e</span></code>&gt; 0 the function relies on a random number generator. This might seem like it would make the function impossible to test since we never know what numbers we will get. However, we can cause our random function to generate the same set of values every time by using something called a random number seed. A random seed is the starting point in generating random numbers.</p>
<p>Let’s try setting our random seed to 0:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-2">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, generate a random number:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-3" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-3">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="output" for="sd-tab-item-4">
OUTPUT</label><div class="sd-tab-content docutils">
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">0.8444218515250481</span>
</pre></div>
</div>
</div>
</div>
<p>Everyone should see the same output for this. Rerun your random number generator again, and you should see <code class="docutils literal notranslate"><span class="pre">0.7579544029403025</span></code>.</p>
<p>Set your random number seed to a different number:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-5" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-5">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="output" for="sd-tab-item-6">
OUTPUT</label><div class="sd-tab-content docutils">
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">0.6229016948897019</span>
</pre></div>
</div>
</div>
</div>
<p>Now, reset your seed to 0:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-7" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-7">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="output" for="sd-tab-item-8">
OUTPUT</label><div class="sd-tab-content docutils">
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">0.8444218515250481</span>
</pre></div>
</div>
</div>
</div>
<p>You will notice that this is the same random number you got before when you set the seed to 0. Setting a random number seed means that when that seed is set, you will always get the same sequence of random numbers. We will use this for the sanity check of our function.</p>
<p>For writing our test cases, we will use a reduced temperature of <code class="docutils literal notranslate"><span class="pre">1</span></code>, or a <code class="docutils literal notranslate"><span class="pre">beta</span></code> value of <code class="docutils literal notranslate"><span class="pre">1</span></code>. We need to set the seed before this test to a value that would cause our criteria to return True. Our acceptance criteria is that the random number we generate has to be less than our probability of acceptance. For <span class="math notranslate nohighlight">\(1/\beta = 1\)</span> and <span class="math notranslate nohighlight">\(\Delta U = 1\)</span>, our expression is <span class="math notranslate nohighlight">\(e^{-1}\)</span>, or a roughly a 37% chance of the move being accepted. Our random number must be less than this in order for our function to return True.</p>
<p>We already know that when we set the random number seed to zero, our first value will be higher than this. If our function behaves correctly, the function should return <code class="docutils literal notranslate"><span class="pre">False</span></code> after we set the seed to 0.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-9" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-9">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">delta_e</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">accept_or_reject</span><span class="p">(</span><span class="n">delta_e</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we should find a random seed that returns less than 0.37. Through trial and error, we discover that setting the random seed to be 1 will work:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-10" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-10">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">delta_e</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">accept_or_reject</span><span class="p">(</span><span class="n">delta_e</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>After we’ve done these checks, it is a good idea to unset the random seed so that our numbers are random again:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-11" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-11">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="energy-calculation">
<h2>Energy Calculation<a class="headerlink" href="#energy-calculation" title="Link to this heading">#</a></h2>
<p>In our Monte Carlo loop, we will be calculating the change in energy from a particle movement to decide whether to accept or reject that movement. Previously, we calculated the total pairwise energy for particles. However, when we move a particle, we only need to calculate the energy change for that one particle. We will write a new function for calculating the pairwise interaction energy of a single particle.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-12">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">i_particle</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the interaction energy of a particle with its environment (all other particles in the system)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coordinates : list</span>
<span class="sd">        The coordinates for all particles in the system</span>
<span class="sd">        </span>
<span class="sd">    i_particle : int</span>
<span class="sd">        The particle number for which to calculate the energy</span>
<span class="sd">        </span>
<span class="sd">    cutoff : float</span>
<span class="sd">        The simulation cutoff. Beyond this distance, interactions are not calculated.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    e_total : float </span>
<span class="sd">        The pairwise interaction energy of he i_th particle with all other particles in the system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">e_total</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">i_position</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">i_particle</span><span class="p">]</span>
 
    <span class="n">num_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j_particle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i_particle</span> <span class="o">!=</span> <span class="n">j_particle</span><span class="p">:</span>

            <span class="n">j_position</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">j_particle</span><span class="p">]</span>
            <span class="n">rij</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">i_position</span><span class="p">,</span> <span class="n">j_position</span><span class="p">,</span> <span class="n">box_length</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rij</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
                <span class="n">e_pair</span> <span class="o">=</span> <span class="n">calculate_LJ</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
                <span class="n">e_total</span> <span class="o">+=</span> <span class="n">e_pair</span>

    <span class="k">return</span> <span class="n">e_total</span>
</pre></div>
</div>
</div>
</div>
<section id="sanity-checks">
<h3>Sanity Checks<a class="headerlink" href="#sanity-checks" title="Link to this heading">#</a></h3>
<p>We’ll use the same system of three particles to check this function.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-13" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-13">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coordinates</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">))]]</span>

<span class="k">assert</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span>

<span class="k">assert</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Link to this heading">#</a></h2>
<p>Now that we have written the functions we need, we will now write the simulation loop.</p>
<p>We start by defining the simulation parameters. We set the reduced temperature and the number of Monte Carlo steps are going to attempt, as well as the maximum distance we will displace a particle during a Monte Carlo move. We also set a variable here called <code class="docutils literal notranslate"><span class="pre">freq</span></code> which is the frequency we want to print out energy values.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-14">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">reduced_temperature</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">max_displacement</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Calculated quantities</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">reduced_temperature</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we must have a system of particles to simulate. We will use the reference system from NIST:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-15" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-15">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read initial coordinates</span>
<span class="n">coordinates</span><span class="p">,</span> <span class="n">box_length</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="s1">&#39;sample_config1.xyz&#39;</span><span class="p">)</span>
<span class="n">num_particles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we set our change in energy to 0 and calculate the total energy of the system.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-16">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">delta_energy</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">total_energy</span> <span class="o">=</span> <span class="n">calculate_total_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
<span class="n">total_energy</span> <span class="o">+=</span> <span class="n">calculate_tail_correction</span><span class="p">(</span><span class="n">num_particles</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We have now finished our initial set-up and are ready for our Monte Carlo loop. We will first create our loop and write in comments what we need to do.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-17" name="sd-tab-set-17" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-17">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
    
    <span class="c1"># 1. Randomly pick one of N particles</span>

    <span class="c1"># 2. Calculate the interaction energy of the selected particle with the system and store this value.</span>
    
    <span class="c1"># 3. Generate random x, y, z displacement</span>

    <span class="c1"># 4. Modify coordinate of Nth particle by generated displacements</span>
        
    <span class="c1"># 5. Calculate interaction energy of moved particle with the system and store this value.</span>
    
    <span class="c1"># 6. Calculate if we accept the move</span>
    
    <span class="c1"># 7. if accept, move particle</span>
    
    <span class="c1"># 8. print energy if step is multiple of freq</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic">
<li><p>Randomly pick one of N particles.
For #1 we have to randomly pick one of N particles. This means we need a number on the range of 0 to 800. Take a look at <a class="reference external" href="https://docs.python.org/3/library/random.html">the documentation</a> for the <code class="docutils literal notranslate"><span class="pre">random</span></code> module and see if you can find a function for this.</p>
<p>The function we will use is <code class="docutils literal notranslate"><span class="pre">rand.randrange</span></code>. If we add <code class="docutils literal notranslate"><span class="pre">num_particles</span></code> as an argument, it will pick a number between 0 and <code class="docutils literal notranslate"><span class="pre">num_particles</span></code> (For our NIST file, this would be between 0 and 799).</p>
</li>
<li><p>Calculate the interaction energy of the selected particle with the system and store this value.</p>
<p>We will use our <code class="docutils literal notranslate"><span class="pre">calculate_pair_energy</span></code> function with the random particle index for this.</p>
</li>
<li><p>Generate a random x, y, z displacement.
For #2, we need to generate three random numbers between -max_displacement and max_displacement. By examining the random documentation again, we will find that the function we want to use is <code class="docutils literal notranslate"><span class="pre">random.uniform</span></code>.</p></li>
<li><p>Modify coordinate of Nth particle by generated displacements.</p>
<p>We will need to change the position of the particle selected in #1 by the values generated in #2.</p>
</li>
<li><p>Calculate interaction energy of moved particle with the system and store this value.</p>
<p>We will use our <code class="docutils literal notranslate"><span class="pre">calculate_pair_energy</span></code> function with our updated coordinates and the random particle index for this.</p>
</li>
<li><p>Calculate if we accept the move</p>
<p>Subtract the original system energy from the new system energy, and use the <code class="docutils literal notranslate"><span class="pre">accept_or_reject</span></code> function.</p>
</li>
<li><p>If accept is <code class="docutils literal notranslate"><span class="pre">True</span></code>, keep the coordinates, otherwise, rollback to our previous value.</p></li>
<li><p>Print energy if step is multiple of freq. We will use the modulus (<code class="docutils literal notranslate"><span class="pre">%</span></code>) operator for this. This operator returns the remainder from division.</p></li>
</ol>
<p>We’ll also add an energies list which we’ll append to every time we print the energy. With these considerations, our final MC loop looks like this.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-18" name="sd-tab-set-18" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="python" for="sd-tab-item-18">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">reduced_temperature</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">max_displacement</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c1"># Calculated quantities</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">reduced_temperature</span>

<span class="c1"># Read initial coordinates</span>
<span class="n">coordinates</span><span class="p">,</span> <span class="n">box_length</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="s1">&#39;sample_config1.xyz&#39;</span><span class="p">)</span>
<span class="n">num_particles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

<span class="n">delta_energy</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_energy</span> <span class="o">=</span> <span class="n">calculate_total_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
<span class="n">total_energy</span> <span class="o">+=</span> <span class="n">calculate_tail_correction</span><span class="p">(</span><span class="n">num_particles</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>

<span class="n">freq</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
    
    <span class="c1"># Randomly pick one of N particles</span>
    <span class="n">random_particle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)</span>
    
    <span class="c1"># Calculate interaction energy of selected particle with the system</span>
    <span class="n">current_energy</span> <span class="o">=</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">random_particle</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
    
    <span class="c1"># Generate random x, y, z displacement</span>
    <span class="n">x_rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">max_displacement</span><span class="p">,</span> <span class="n">max_displacement</span><span class="p">)</span>
    <span class="n">y_rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">max_displacement</span><span class="p">,</span> <span class="n">max_displacement</span><span class="p">)</span>
    <span class="n">z_rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">max_displacement</span><span class="p">,</span> <span class="n">max_displacement</span><span class="p">)</span>
    
    
    <span class="c1"># Modify coordinate of Nth particle by generated displacements</span>
    <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x_rand</span>
    <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_rand</span>
    <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">z_rand</span>
    
    <span class="n">proposed_energy</span> <span class="o">=</span> <span class="n">calculate_pair_energy</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">random_particle</span><span class="p">,</span> <span class="n">box_length</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
    
    <span class="c1"># Calculate change in potential energy for particle move.</span>
    <span class="n">delta_energy</span> <span class="o">=</span> <span class="n">proposed_energy</span> <span class="o">-</span> <span class="n">current_energy</span>

    <span class="n">accept</span> <span class="o">=</span> <span class="n">accept_or_reject</span><span class="p">(</span><span class="n">delta_energy</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">accept</span><span class="p">:</span>
        <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">delta_energy</span>
        <span class="n">n_accept</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Move is not accepted, roll back coordinates</span>
        <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x_rand</span>
        <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">y_rand</span>
        <span class="n">coordinates</span><span class="p">[</span><span class="n">random_particle</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">z_rand</span>
    
    <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">total_energy</span><span class="o">/</span><span class="n">num_particles</span><span class="p">)</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_energy</span><span class="o">/</span><span class="n">num_particles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>At the end of your MC run, you will have a list of steps, energies, and your coordinates will be updated to the final MC step.</p>
<div class="key admonition">
<p class="admonition-title">Key Points</p>
<ul class="simple">
<li><p>Thermodynamic properties of a system can be thought of as a very high dimensional integral.</p></li>
</ul>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-slides">Lesson Slides</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-the-monte-carlo-loop">Writing the Monte Carlo Loop</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-sampling">Importance Sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acceptance-criteria">Acceptance Criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-of-calculations">Flow of Calculations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-numbers">Random Numbers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-calculation">Energy Calculation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-checks">Sanity Checks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/day4/02-LJ-MC.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  



  
  
  
  
  
  
  


<div class="row h-10">
    <div class="col-2">
        <a href="https://molssi.org/" target="_blank" title="Go to MolSSI in a new tab">
            <img src="../_static/molssi_main_logo.png" class="logo__image only-light footer_logo" alt="Logo image">
            <img src="../_static/molssi_main_logo_inverted_white.png" class="logo__image only-dark footer_logo" alt="Logo image">
        </a>
    </div>
    <div class="col-8">
        <p> &copy; Copyright 2019-2024 <a href="https://molssi.org/">The Molecular Sciences Software Institute</a></p>
        <p>Funded by the National Science Foundation 
          <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1547580">OAC-1547580</a> and 
          <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2136142">CHE-2136142.</a></p>
 
        
        <p class="sphinx-version">
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.4.7.<br>
        </p>
        

        <p class="theme-version">
        Built with a customized <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
        </p>

    </div>
    <div class="col-2">
        <a href="https://nsf.gov/" target="_blank" title="Go to the NSF in a new tab">
            <img src="../_static/nsf.png" class="footer_logo" alt="The NSF">
          </a>
    </div>
</div></div>
      
    </div>
  
  
  
</div>

  </footer>
  </body>
</html>